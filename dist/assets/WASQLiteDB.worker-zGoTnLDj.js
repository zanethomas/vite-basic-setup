let Pn,z,Qn,Bn,zn,Un,Dn,Gn,jn,Vn,Kn,An,Wn,Hn,Fn,Jn,$n,Xn,Yn;let __tla=(async()=>{const rn=Symbol("Comlink.proxy"),mn=Symbol("Comlink.endpoint"),hn=Symbol("Comlink.releaseProxy"),H=Symbol("Comlink.finalizer"),B=Symbol("Comlink.thrown"),sn=e=>typeof e=="object"&&e!==null||typeof e=="function",wn={canHandle:e=>sn(e)&&e[rn],serialize(e){const{port1:n,port2:i}=new MessageChannel;return j(e,n),[i,[i]]},deserialize(e){return e.start(),yn(e)}},pn={canHandle:e=>sn(e)&&B in e,serialize({value:e}){let n;return e instanceof Error?n={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:n={isError:!1,value:e},[n,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},cn=new Map([["proxy",wn],["throw",pn]]);function gn(e,n){for(const i of e)if(n===i||i==="*"||i instanceof RegExp&&i.test(n))return!0;return!1}function j(e,n=globalThis,i=["*"]){n.addEventListener("message",function m(a){if(!a||!a.data)return;if(!gn(i,a.origin)){console.warn(`Invalid origin '${a.origin}' for comlink proxy`);return}const{id:b,type:w,path:g}=Object.assign({path:[]},a.data),y=(a.data.argumentList||[]).map(v);let h;try{const f=g.slice(0,-1).reduce((T,d)=>T[d],e),l=g.reduce((T,d)=>T[d],e);switch(w){case"GET":h=l;break;case"SET":f[g.slice(-1)[0]]=v(a.data.value),h=!0;break;case"APPLY":h=l.apply(f,y);break;case"CONSTRUCT":{const T=new l(...y);h=k(T)}break;case"ENDPOINT":{const{port1:T,port2:d}=new MessageChannel;j(e,d),h=qn(T,[T])}break;case"RELEASE":h=void 0;break;default:return}}catch(f){h={value:f,[B]:0}}Promise.resolve(h).catch(f=>({value:f,[B]:0})).then(f=>{const[l,T]=W(f);n.postMessage(Object.assign(Object.assign({},l),{id:b}),T),w==="RELEASE"&&(n.removeEventListener("message",m),on(n),H in e&&typeof e[H]=="function"&&e[H]())}).catch(f=>{const[l,T]=W({value:new TypeError("Unserializable return value"),[B]:0});n.postMessage(Object.assign(Object.assign({},l),{id:b}),T)})}),n.start&&n.start()}function bn(e){return e.constructor.name==="MessagePort"}function on(e){bn(e)&&e.close()}function yn(e,n){return G(e,[],n)}function Q(e){if(e)throw new Error("Proxy has been released and is not useable")}function an(e){return C(e,{type:"RELEASE"}).then(()=>{on(e)})}const D=new WeakMap,F="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const n=(D.get(e)||0)-1;D.set(e,n),n===0&&an(e)});function En(e,n){const i=(D.get(n)||0)+1;D.set(n,i),F&&F.register(e,n,e)}function dn(e){F&&F.unregister(e)}function G(e,n=[],i=function(){}){let m=!1;const a=new Proxy(i,{get(b,w){if(Q(m),w===hn)return()=>{dn(a),an(e),m=!0};if(w==="then"){if(n.length===0)return{then:()=>a};const g=C(e,{type:"GET",path:n.map(y=>y.toString())}).then(v);return g.then.bind(g)}return G(e,[...n,w])},set(b,w,g){Q(m);const[y,h]=W(g);return C(e,{type:"SET",path:[...n,w].map(f=>f.toString()),value:y},h).then(v)},apply(b,w,g){Q(m);const y=n[n.length-1];if(y===mn)return C(e,{type:"ENDPOINT"}).then(v);if(y==="bind")return G(e,n.slice(0,-1));const[h,f]=$(g);return C(e,{type:"APPLY",path:n.map(l=>l.toString()),argumentList:h},f).then(v)},construct(b,w){Q(m);const[g,y]=$(w);return C(e,{type:"CONSTRUCT",path:n.map(h=>h.toString()),argumentList:g},y).then(v)}});return En(a,e),a}function Tn(e){return Array.prototype.concat.apply([],e)}function $(e){const n=e.map(W);return[n.map(i=>i[0]),Tn(n.map(i=>i[1]))]}const un=new WeakMap;function qn(e,n){return un.set(e,n),e}function k(e){return Object.assign(e,{[rn]:!0})}function W(e){for(const[n,i]of cn)if(i.canHandle(e)){const[m,a]=i.serialize(e);return[{type:"HANDLER",name:n,value:m},a]}return[{type:"RAW",value:e},un.get(e)||[]]}function v(e){switch(e.type){case"HANDLER":return cn.get(e.name).deserialize(e.value);case"RAW":return e.value}}function C(e,n,i){return new Promise(m=>{const a=Ln();e.addEventListener("message",function b(w){!w.data||!w.data.id||w.data.id!==a||(e.removeEventListener("message",b),m(w.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:a},n),i)})}function Ln(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let O,V,Sn,K,fn,In,X,Y,J,Z,M;z=0;Un=5;Pn=10;Qn=12;Bn=14;O=21;V=25;Sn=27;K=100;fn=101;Dn=3850;Fn=522;Wn=1;In=2;An=4;Hn=8;zn=0;Vn=1;Gn=2;Kn=3;jn=4;$n=512;Xn=1024;Yn=2048;Jn=16384;X=1;Y=2;J=3;Z=4;M=5;typeof BigInt.prototype.toJSON>"u"&&(BigInt.prototype.toJSON=function(){return this.toString()});const nn=0x7fffffffffffffffn,tn=-0x8000000000000000n;class x extends Error{constructor(n,i){super(n),this.code=i}}const R=!0,ln={};globalThis.__onTablesChanged=function(e,n,i,m){setTimeout(()=>ln[e]?.(n,i,m),0)};function xn(e){const n={},i=e._getSqliteFree(),m=e._malloc(8),a=[m,m+4];function b(s){if(typeof s!="string")return 0;const r=e.lengthBytesUTF8(s),t=e._sqlite3_malloc(r+1);return e.stringToUTF8(s,t,r+1),t}function w(s,r){return BigInt(r)<<32n|BigInt(s)&4294967295n}const g=function(){const s=BigInt(Number.MAX_SAFE_INTEGER)>>32n,r=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(t,c){return c>s||c<r?w(t,c):c*4294967296+(t&2147483647)-(t&2147483648)}}(),y=new Set;function h(s){if(!y.has(s))throw new x("not a database",O)}const f=new Map;function l(s){if(!f.has(s))throw new x("not a statement",O)}n.bind_collection=function(s,r){l(s);const t=Array.isArray(r),c=n.bind_parameter_count(s);for(let o=1;o<=c;++o){const u=t?o-1:n.bind_parameter_name(s,o),p=r[u];p!==void 0&&n.bind(s,o,p)}return z},n.bind=function(s,r,t){switch(l(s),typeof t){case"number":return t===(t|0)?n.bind_int(s,r,t):n.bind_double(s,r,t);case"string":return n.bind_text(s,r,t);default:return t instanceof Uint8Array||Array.isArray(t)?n.bind_blob(s,r,t):t===null?n.bind_null(s,r):typeof t=="bigint"?n.bind_int64(s,r,t):t===void 0?Sn:(console.warn("unknown binding converted to null",t),n.bind_null(s,r))}},n.bind_blob=function(){const s="sqlite3_bind_blob",r=e.cwrap(s,..._("nnnnn:n"));return function(t,c,o){l(t);const u=o.byteLength??o.length,p=e._sqlite3_malloc(u);e.HEAPU8.subarray(p).set(o);const S=r(t,c,p,u,i);return E(s,S,f.get(t))}}(),n.bind_parameter_count=function(){const r=e.cwrap("sqlite3_bind_parameter_count",..._("n:n"));return function(t){return l(t),r(t)}}(),n.bind_double=function(){const s="sqlite3_bind_double",r=e.cwrap(s,..._("nnn:n"));return function(t,c,o){l(t);const u=r(t,c,o);return E(s,u,f.get(t))}}(),n.bind_int=function(){const s="sqlite3_bind_int",r=e.cwrap(s,..._("nnn:n"));return function(t,c,o){if(l(t),o>2147483647||o<-2147483648)return V;const u=r(t,c,o);return E(s,u,f.get(t))}}(),n.bind_int64=function(){const s="sqlite3_bind_int64",r=e.cwrap(s,..._("nnnn:n"));return function(t,c,o){if(l(t),o>nn||o<tn)return V;const u=o&4294967295n,p=o>>32n,S=r(t,c,Number(u),Number(p));return E(s,S,f.get(t))}}(),n.bind_null=function(){const s="sqlite3_bind_null",r=e.cwrap(s,..._("nn:n"));return function(t,c){l(t);const o=r(t,c);return E(s,o,f.get(t))}}(),n.bind_parameter_name=function(){const r=e.cwrap("sqlite3_bind_parameter_name",..._("n:s"));return function(t,c){return l(t),r(t,c)}}(),n.bind_text=function(){const s="sqlite3_bind_text",r=e.cwrap(s,..._("nnnnn:n"));return function(t,c,o){l(t);const u=b(o),p=r(t,c,u,-1,i);return E(s,p,f.get(t))}}(),n.changes=function(){const r=e.cwrap("sqlite3_changes",..._("n:n"));return function(t){return h(t),r(t)}}(),n.last_insert_id=function(){const r=e.cwrap("sqlite3_last_insert_rowid",..._("n:n"));return function(t){return h(t),r(t)}}(),n.close=function(){const s="sqlite3_close",r=e.cwrap(s,..._("n:n"),{async:R});return async function(t){h(t);const c=await r(t);return y.delete(t),E(s,c,t)}}(),n.column=function(s,r){l(s);const t=n.column_type(s,r);switch(t){case Z:return n.column_blob(s,r);case Y:return n.column_double(s,r);case X:const c=n.column_int(s,r),o=e.getTempRet0();return g(c,o);case M:return null;case J:return n.column_text(s,r);default:throw new x("unknown type",t)}},n.column_blob=function(){const r=e.cwrap("sqlite3_column_blob",..._("nn:n"));return function(t,c){l(t);const o=n.column_bytes(t,c),u=r(t,c);return e.HEAPU8.subarray(u,u+o)}}(),n.column_bytes=function(){const r=e.cwrap("sqlite3_column_bytes",..._("nn:n"));return function(t,c){return l(t),r(t,c)}}(),n.column_count=function(){const r=e.cwrap("sqlite3_column_count",..._("n:n"));return function(t){return l(t),r(t)}}(),n.column_double=function(){const r=e.cwrap("sqlite3_column_double",..._("nn:n"));return function(t,c){return l(t),r(t,c)}}(),n.column_int=function(){const r=e.cwrap("sqlite3_column_int64",..._("nn:n"));return function(t,c){return l(t),r(t,c)}}(),n.column_int64=function(){const r=e.cwrap("sqlite3_column_int64",..._("nn:n"));return function(t,c){l(t);const o=r(t,c),u=e.getTempRet0();return w(o,u)}}(),n.column_name=function(){const r=e.cwrap("sqlite3_column_name",..._("nn:s"));return function(t,c){return l(t),r(t,c)}}(),n.column_names=function(s){const r=[],t=n.column_count(s);for(let c=0;c<t;++c)r.push(n.column_name(s,c));return r},n.column_text=function(){const r=e.cwrap("sqlite3_column_text",..._("nn:s"));return function(t,c){return l(t),r(t,c)}}(),n.column_type=function(){const r=e.cwrap("sqlite3_column_type",..._("nn:n"));return function(t,c){return l(t),r(t,c)}}(),n.create_function=function(s,r,t,c,o,u,p,S){if(h(s),u&&!p&&!S){const q=e.createFunction(s,r,t,c,o,u);return E("sqlite3_create_function",q,s)}if(!u&&p&&S){const q=e.createAggregate(s,r,t,c,o,p,S);return E("sqlite3_create_function",q,s)}throw new x("invalid function combination",O)},n.create_module=function(s,r,t,c){h(s);const o=e.createModule(s,r,t,c);return E("sqlite3_create_module",o,s)},n.data_count=function(){const r=e.cwrap("sqlite3_data_count",..._("n:n"));return function(t){return l(t),r(t)}}(),n.declare_vtab=function(){const r=e.cwrap("sqlite3_declare_vtab",..._("ns:n"));return function(t,c){const o=r(t,c);return E("sqlite3_declare_vtab",o)}}(),n.exec=async function(s,r,t){for await(const c of n.statements(s,r)){let o;for(;await n.step(c)===K;)if(t){o=o??n.column_names(c);const u=n.row(c);await t(u,o)}}return z},n.finalize=function(){const r=e.cwrap("sqlite3_finalize",..._("n:n"),{async:R});return async function(t){if(!f.has(t))return O;const c=await r(t);return f.get(t),f.delete(t),c}}(),n.get_autocommit=function(){const r=e.cwrap("sqlite3_get_autocommit",..._("n:n"));return function(t){return r(t)}}(),n.libversion=function(){const r=e.cwrap("sqlite3_libversion",..._(":s"));return function(){return r()}}(),n.libversion_number=function(){const r=e.cwrap("sqlite3_libversion_number",..._(":n"));return function(){return r()}}(),n.limit=function(){const r=e.cwrap("sqlite3_limit",..._("nnn:n"));return function(t,c,o){return r(t,c,o)}}(),n.open_v2=function(){const s="sqlite3_open_v2",r=e.cwrap(s,..._("snnn:n"),{async:R});return async function(t,c,o){c=c||An|In,o=b(o),e.ccall("setup_powersync","int",[]);const u=await r(t,a[0],c,o),p=e.getValue(a[0],"*");return y.add(p),e._sqlite3_free(o),e.ccall("RegisterExtensionFunctions","void",["number"],[p]),E(s,u),p}}(),n.register_table_onchange_hook=function(s,r){e.ccall("register_table_update_hook","int",["number"],[s]),ln[s]=function(t,c,o){const u=new DataView(e.HEAPU8.buffer);let p=0;for(;u.getUint8(c+p)!==0;)p++;const S=new Uint8Array(e.HEAPU8.buffer,c,p),q=new TextDecoder().decode(S);return r(t,q,o)}},n.prepare_v2=function(){const s="sqlite3_prepare_v2",r=e.cwrap(s,..._("nnnnn:n"),{async:R});return async function(t,c){const o=await r(t,c,-1,a[0],a[1]);E(s,o,t);const u=e.getValue(a[0],"*");return u?(f.set(u,t),{stmt:u,sql:e.getValue(a[1],"*")}):null}}(),n.progress_handler=function(s,r,t,c){h(s),e.progressHandler(s,r,t,c)},n.reset=function(){const s="sqlite3_reset",r=e.cwrap(s,..._("n:n"),{async:R});return async function(t){l(t);const c=await r(t);return E(s,c,f.get(t))}}(),n.result=function(s,r){switch(typeof r){case"number":r===(r|0)?n.result_int(s,r):n.result_double(s,r);break;case"string":n.result_text(s,r);break;default:if(r instanceof Uint8Array||Array.isArray(r))n.result_blob(s,r);else if(r===null)n.result_null(s);else{if(typeof r=="bigint")return n.result_int64(s,r);console.warn("unknown result converted to null",r),n.result_null(s)}break}},n.result_blob=function(){const r=e.cwrap("sqlite3_result_blob",..._("nnnn:n"));return function(t,c){const o=c.byteLength??c.length,u=e._sqlite3_malloc(o);e.HEAPU8.subarray(u).set(c),r(t,u,o,i)}}(),n.result_double=function(){const r=e.cwrap("sqlite3_result_double",..._("nn:n"));return function(t,c){r(t,c)}}(),n.result_int=function(){const r=e.cwrap("sqlite3_result_int",..._("nn:n"));return function(t,c){r(t,c)}}(),n.result_int64=function(){const r=e.cwrap("sqlite3_result_int64",..._("nnn:n"));return function(t,c){if(c>nn||c<tn)return V;const o=c&4294967295n,u=c>>32n;r(t,Number(o),Number(u))}}(),n.result_null=function(){const r=e.cwrap("sqlite3_result_null",..._("n:n"));return function(t){r(t)}}(),n.result_text=function(){const r=e.cwrap("sqlite3_result_text",..._("nnnn:n"));return function(t,c){const o=b(c);r(t,o,-1,i)}}(),n.row=function(s){const r=[],t=n.data_count(s);for(let c=0;c<t;++c){const o=n.column(s,c);r.push(o?.buffer===e.HEAPU8.buffer?o.slice():o)}return r},n.set_authorizer=function(s,r,t){h(s);const c=e.setAuthorizer(s,r,t);return E("sqlite3_set_authorizer",c,s)},n.sql=function(){const r=e.cwrap("sqlite3_sql",..._("n:s"));return function(t){return l(t),r(t)}}(),n.statements=function(s,r){return async function*(){const t=n.str_new(s,r);let c={stmt:null,sql:n.str_value(t)};try{for(;c=await n.prepare_v2(s,c.sql);)yield c.stmt,n.finalize(c.stmt),c.stmt=null}finally{c?.stmt&&n.finalize(c.stmt),n.str_finish(t)}}()},n.step=function(){const s="sqlite3_step",r=e.cwrap(s,..._("n:n"),{async:R});return async function(t){l(t);const c=await r(t);return E(s,c,f.get(t),[K,fn])}}();let T=0;const d=new Map;n.str_new=function(s,r=""){const t=e.lengthBytesUTF8(r),c=T++&4294967295,o={offset:e._sqlite3_malloc(t+1),bytes:t};return d.set(c,o),e.stringToUTF8(r,o.offset,o.bytes+1),c},n.str_appendall=function(s,r){if(!d.has(s))throw new x("not a string",O);const t=d.get(s),c=e.lengthBytesUTF8(r),o=t.bytes+c,u=e._sqlite3_malloc(o+1);e.HEAPU8.subarray(u,u+o+1).set(e.HEAPU8.subarray(t.offset,t.offset+t.bytes)),e.stringToUTF8(r,u+t.bytes,c+1),e._sqlite3_free(t.offset),t.offset=u,t.bytes=o,d.set(s,t)},n.str_finish=function(s){if(!d.has(s))throw new x("not a string",O);const r=d.get(s);d.delete(s),e._sqlite3_free(r.offset)},n.str_value=function(s){if(!d.has(s))throw new x("not a string",O);return d.get(s).offset},n.user_data=function(s){return e.getFunctionUserData(s)},n.value=function(s){const r=n.value_type(s);switch(r){case Z:return n.value_blob(s);case Y:return n.value_double(s);case X:const t=n.value_int(s),c=e.getTempRet0();return g(t,c);case M:return null;case J:return n.value_text(s);default:throw new x("unknown type",r)}},n.value_blob=function(){const r=e.cwrap("sqlite3_value_blob",..._("n:n"));return function(t){const c=n.value_bytes(t),o=r(t);return e.HEAPU8.subarray(o,o+c)}}(),n.value_bytes=function(){const r=e.cwrap("sqlite3_value_bytes",..._("n:n"));return function(t){return r(t)}}(),n.value_double=function(){const r=e.cwrap("sqlite3_value_double",..._("n:n"));return function(t){return r(t)}}(),n.value_int=function(){const r=e.cwrap("sqlite3_value_int64",..._("n:n"));return function(t){return r(t)}}(),n.value_int64=function(){const r=e.cwrap("sqlite3_value_int64",..._("n:n"));return function(t){const c=r(t),o=e.getTempRet0();return w(c,o)}}(),n.value_text=function(){const r=e.cwrap("sqlite3_value_text",..._("n:s"));return function(t){return r(t)}}(),n.value_type=function(){const r=e.cwrap("sqlite3_value_type",..._("n:n"));return function(t){return r(t)}}(),n.vfs_register=function(s,r){const t=e.registerVFS(s,r);return E("sqlite3_vfs_register",t)};function E(s,r,t=null,c=[z]){if(c.includes(r))return r;const o=t?e.ccall("sqlite3_errmsg","string",["number"],[t]):s;throw new x(o,r)}return n}function _(e){const n=[],i=e.match(/([ns@]*):([nsv@])/);switch(i[2]){case"n":n.push("number");break;case"s":n.push("string");break;case"v":n.push(null);break}const m=[];for(let a of i[1])switch(a){case"n":m.push("number");break;case"s":m.push("string");break}return n.push(m),n}const On=new Error("request for lock canceled");var kn=function(e,n,i,m){function a(b){return b instanceof i?b:new i(function(w){w(b)})}return new(i||(i=Promise))(function(b,w){function g(f){try{h(m.next(f))}catch(l){w(l)}}function y(f){try{h(m.throw(f))}catch(l){w(l)}}function h(f){f.done?b(f.value):a(f.value).then(g,y)}h((m=m.apply(e,n||[])).next())})};class vn{constructor(n,i=On){this._value=n,this._cancelError=i,this._weightedQueues=[],this._weightedWaiters=[]}acquire(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);return new Promise((i,m)=>{this._weightedQueues[n-1]||(this._weightedQueues[n-1]=[]),this._weightedQueues[n-1].push({resolve:i,reject:m}),this._dispatch()})}runExclusive(n,i=1){return kn(this,void 0,void 0,function*(){const[m,a]=yield this.acquire(i);try{return yield n(m)}finally{a()}})}waitForUnlock(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);return new Promise(i=>{this._weightedWaiters[n-1]||(this._weightedWaiters[n-1]=[]),this._weightedWaiters[n-1].push(i),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(n){this._value=n,this._dispatch()}release(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);this._value+=n,this._dispatch()}cancel(){this._weightedQueues.forEach(n=>n.forEach(i=>i.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var n;for(let i=this._value;i>0;i--){const m=(n=this._weightedQueues[i-1])===null||n===void 0?void 0:n.shift();if(!m)continue;const a=this._value,b=i;this._value-=i,i=this._value+1,m.resolve([a,this._newReleaser(b)])}this._drainUnlockWaiters()}_newReleaser(n){let i=!1;return()=>{i||(i=!0,this.release(n))}}_drainUnlockWaiters(){for(let n=this._value;n>0;n--)this._weightedWaiters[n-1]&&(this._weightedWaiters[n-1].forEach(i=>i()),this._weightedWaiters[n-1]=[])}}var Nn=function(e,n,i,m){function a(b){return b instanceof i?b:new i(function(w){w(b)})}return new(i||(i=Promise))(function(b,w){function g(f){try{h(m.next(f))}catch(l){w(l)}}function y(f){try{h(m.throw(f))}catch(l){w(l)}}function h(f){f.done?b(f.value):a(f.value).then(g,y)}h((m=m.apply(e,n||[])).next())})};class Rn{constructor(n){this._semaphore=new vn(1,n)}acquire(){return Nn(this,void 0,void 0,function*(){const[,n]=yield this._semaphore.acquire();return n})}runExclusive(n){return this._semaphore.runExclusive(()=>n())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}let en=1;async function Cn(e,n={useWebWorker:!0}){const{default:i}=await import("./wa-sqlite-async-BQPTkA7Y.js"),m=await i(),a=xn(m),{IDBBatchAtomicVFS:b}=await import("./IDBBatchAtomicVFS-B8QVsiys.js"),w=new b(e);a.vfs_register(w,!0);const g=await a.open_v2(e),y=new Rn,h=new Map;let f=new Set,l=null;function T(){l=null;const c={tables:[...f],groupedUpdates:{},rawUpdates:[]};f.clear(),Array.from(h.values()).forEach(o=>o(c))}a.register_table_onchange_hook(g,(c,o,u)=>{f.add(o),l==null&&(l=setTimeout(T,0))});const d=async(c,o)=>E(async()=>s(c,o)),E=c=>y.runExclusive(c),s=async(c,o)=>{const u=[];for await(const q of a.statements(g,c)){let L;const N=o?[o]:[[]];for(const I of N){I.forEach((A,P,_n)=>{typeof A=="boolean"&&(_n[P]=A?1:0)}),a.reset(q),o&&a.bind_collection(q,I);const U=[];for(;await a.step(q)===K;){const A=a.row(q);U.push(A)}L=L??a.column_names(q),L.length&&u.push({columns:L,rows:U})}if(o)break}const p=[];for(const q of u)for(const L of q.rows){const N={};q.columns.forEach((I,U)=>{N[I]=L[U]}),p.push(N)}return{insertId:a.last_insert_id(g),rowsAffected:a.changes(g),rows:{_array:p,length:p.length}}},r=async(c,o)=>E(async()=>{let u=0;const p=a.str_new(g,c),S=a.str_value(p);try{await s("BEGIN TRANSACTION");const L=await a.prepare_v2(g,S);if(L===null)return{rowsAffected:0,rows:{_array:[],length:0}};const N=o||[];for(const I of N){for(let A=0;A<I.length;A++){const P=I[A];typeof P=="boolean"&&(I[A]=P?1:0)}a.reset(L.stmt),o&&a.bind_collection(L.stmt,I),await a.step(L.stmt)===fn&&(u+=a.changes(g))}await a.finalize(L.stmt),await s("COMMIT")}catch{return await s("ROLLBACK"),{rowsAffected:0,rows:{_array:[],length:0}}}finally{a.str_finish(p)}return{rowsAffected:u,rows:{_array:[],length:0}}});if(n.useWebWorker){const c=o=>{const u=en++;return h.set(u,o),k(()=>{h.delete(u)})};return{execute:k(d),executeBatch:k(r),registerOnTableChange:k(c),close:k(()=>{a.close(g)})}}return{execute:d,executeBatch:r,registerOnTableChange:c=>{const o=en++;return h.set(o,c),()=>{h.delete(o)}},close:()=>a.close(g)}}j(async e=>k(await Cn(e)))})();export{Pn as S,z as a,Qn as b,Bn as c,zn as d,Un as e,Dn as f,Gn as g,jn as h,Vn as i,Kn as j,An as k,Wn as l,Hn as m,Fn as n,Jn as o,$n as p,Xn as q,Yn as r,__tla};